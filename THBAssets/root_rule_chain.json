{
  "ruleChain": {
    "additionalInfo": null,
    "name": "Root Rule Chain",
    "firstRuleNodeId": null,
    "root": false,
    "debugMode": false,
    "configuration": null
  },
  "metadata": {
    "firstNodeIndex": 0,
    "nodes": [
      {
        "additionalInfo": {
          "layoutX": 307,
          "layoutY": 118
        },
        "type": "org.thingsboard.rule.engine.filter.TbMsgTypeSwitchNode",
        "name": "Message Type Switch",
        "debugMode": true,
        "configuration": {
          "version": 0
        }
      },
      {
        "additionalInfo": {
          "layoutX": 73,
          "layoutY": 452
        },
        "type": "org.thingsboard.rule.engine.filter.TbJsFilterNode",
        "name": "Ambient Light Dark",
        "debugMode": true,
        "configuration": {
          "jsScript": "return typeof msg.valorLDR === 'undefined' \n        || (msg.operatingMode === true && (msg.valorLDR >= 0 && msg.valorLDR < metadata.shared_darkMax));"
        }
      },
      {
        "additionalInfo": {
          "layoutX": 742,
          "layoutY": 388
        },
        "type": "org.thingsboard.rule.engine.transform.TbTransformMsgNode",
        "name": "Command Led ON",
        "debugMode": true,
        "configuration": {
          "jsScript": "var msg = {\"method\":\"setDimValueOnDevice\",\"params\":metadata.shared_lightONCmdValue};\nvar metadata = { \"requestId\": \"cmd\"};\nvar msgType = \"DebugMsg\";\n\nreturn { msg: msg, metadata: metadata, msgType: msgType };"
        }
      },
      {
        "additionalInfo": {
          "layoutX": 1046,
          "layoutY": 294
        },
        "type": "org.thingsboard.rule.engine.rpc.TbSendRPCRequestNode",
        "name": "send Command",
        "debugMode": true,
        "configuration": {
          "timeoutInSeconds": 60
        }
      },
      {
        "additionalInfo": {
          "layoutX": 230,
          "layoutY": 572
        },
        "type": "org.thingsboard.rule.engine.filter.TbJsFilterNode",
        "name": "Ambient Light Normal",
        "debugMode": true,
        "configuration": {
          "jsScript": "return typeof msg.valorLDR === 'undefined' \n        || (msg.operatingMode === true && (msg.valorLDR >= metadata.shared_darkMax && msg.valorLDR < metadata.shared_normalMax));"
        }
      },
      {
        "additionalInfo": {
          "layoutX": 778,
          "layoutY": 470
        },
        "type": "org.thingsboard.rule.engine.transform.TbTransformMsgNode",
        "name": "Command Led DIM",
        "debugMode": true,
        "configuration": {
          "jsScript": "var msg = {\"method\":\"setDimValueOnDevice\",\"params\":metadata.shared_lightDIMCmdValue};\nvar metadata = { \"requestId\": \"cmd\"};\nvar msgType = \"DebugMsg\";\n\nreturn { msg: msg, metadata: metadata, msgType: msgType };"
        }
      },
      {
        "additionalInfo": {
          "layoutX": 839,
          "layoutY": 617
        },
        "type": "org.thingsboard.rule.engine.transform.TbTransformMsgNode",
        "name": "Command Led OFF",
        "debugMode": true,
        "configuration": {
          "jsScript": "var msg = {\"method\":\"setDimValueOnDevice\",\"params\":metadata.shared_lightOFFCmdValue};\nvar metadata = { \"requestId\": \"cmd\"};\nvar msgType = \"DebugMsg\";\n\nreturn { msg: msg, metadata: metadata, msgType: msgType };"
        }
      },
      {
        "additionalInfo": {
          "layoutX": 324,
          "layoutY": 316
        },
        "type": "org.thingsboard.rule.engine.metadata.TbGetAttributesNode",
        "name": "Fetch parameter",
        "debugMode": true,
        "configuration": {
          "clientAttributeNames": [],
          "sharedAttributeNames": [
            "darkMax",
            "normalMax",
            "lightOFFCmdValue",
            "lightONCmdValue",
            "lightDIMCmdValue"
          ],
          "serverAttributeNames": [],
          "latestTsKeyNames": []
        }
      },
      {
        "additionalInfo": {
          "layoutX": 486,
          "layoutY": 13,
          "description": ""
        },
        "type": "org.thingsboard.rule.engine.filter.TbMsgTypeFilterNode",
        "name": "prepareComandToDevice",
        "debugMode": true,
        "configuration": {
          "messageTypes": [
            "TO_SERVER_RPC_REQUEST",
            "RPC_CALL_FROM_SERVER_TO_DEVICE"
          ]
        }
      },
      {
        "additionalInfo": {
          "layoutX": 457,
          "layoutY": 667
        },
        "type": "org.thingsboard.rule.engine.filter.TbJsFilterNode",
        "name": "Ambient Light Bright",
        "debugMode": true,
        "configuration": {
          "jsScript": "return typeof msg.valorLDR === 'undefined' \n        || (msg.operatingMode === true && (msg.valorLDR >= metadata.shared_normalMax));"
        }
      },
      {
        "additionalInfo": {
          "layoutX": 800,
          "layoutY": 8
        },
        "type": "org.thingsboard.rule.engine.filter.TbJsFilterNode",
        "name": "SelectAutoMode",
        "debugMode": true,
        "configuration": {
          "jsScript": "return (msg.method == \"setAutoMode\" && msg.params === \"true\")"
        }
      },
      {
        "additionalInfo": {
          "layoutX": 1064,
          "layoutY": 91
        },
        "type": "org.thingsboard.rule.engine.transform.TbTransformMsgNode",
        "name": "AddOperatingParamsAutoOn",
        "debugMode": true,
        "configuration": {
          "jsScript": "msg = {\"method\" : \"SetAutoMode\", \"params\": {\"auto\": true, \"ledOpMode\": false}}\n\nreturn {msg: msg, metadata: metadata, msgType: msgType};\n\n"
        }
      },
      {
        "additionalInfo": {
          "layoutX": 1051,
          "layoutY": 216
        },
        "type": "org.thingsboard.rule.engine.rpc.TbSendRPCRequestNode",
        "name": "sendtodevice",
        "debugMode": true,
        "configuration": {
          "timeoutInSeconds": 60
        }
      },
      {
        "additionalInfo": {
          "layoutX": 850,
          "layoutY": 105
        },
        "type": "org.thingsboard.rule.engine.transform.TbTransformMsgNode",
        "name": "AddOperatingParamAutoOff",
        "debugMode": true,
        "configuration": {
          "jsScript": "msg = {\"method\" : \"SetAutoMode\", \"params\": {\"auto\": false, \"ledOpMode\": false}}\n\nreturn {msg: msg, metadata: metadata, msgType: msgType};"
        }
      },
      {
        "additionalInfo": {
          "layoutX": 567,
          "layoutY": 146
        },
        "type": "org.thingsboard.rule.engine.filter.TbJsFilterNode",
        "name": "AutoModeOff",
        "debugMode": true,
        "configuration": {
          "jsScript": "return (msg.method == \"setAutoMode\" && msg.params === \"false\")"
        }
      },
      {
        "additionalInfo": {
          "layoutX": 591,
          "layoutY": 294
        },
        "type": "org.thingsboard.rule.engine.telemetry.TbMsgTimeseriesNode",
        "name": "SaveTelemetryData",
        "debugMode": true,
        "configuration": {
          "defaultTTL": 0
        }
      }
    ],
    "connections": [
      {
        "fromIndex": 0,
        "toIndex": 7,
        "type": "Post telemetry"
      },
      {
        "fromIndex": 0,
        "toIndex": 8,
        "type": "RPC Request to Device"
      },
      {
        "fromIndex": 1,
        "toIndex": 4,
        "type": "False"
      },
      {
        "fromIndex": 1,
        "toIndex": 2,
        "type": "True"
      },
      {
        "fromIndex": 2,
        "toIndex": 3,
        "type": "Success"
      },
      {
        "fromIndex": 4,
        "toIndex": 9,
        "type": "False"
      },
      {
        "fromIndex": 4,
        "toIndex": 5,
        "type": "True"
      },
      {
        "fromIndex": 5,
        "toIndex": 3,
        "type": "Success"
      },
      {
        "fromIndex": 6,
        "toIndex": 3,
        "type": "Success"
      },
      {
        "fromIndex": 7,
        "toIndex": 1,
        "type": "Success"
      },
      {
        "fromIndex": 7,
        "toIndex": 15,
        "type": "Success"
      },
      {
        "fromIndex": 8,
        "toIndex": 10,
        "type": "True"
      },
      {
        "fromIndex": 9,
        "toIndex": 6,
        "type": "True"
      },
      {
        "fromIndex": 10,
        "toIndex": 14,
        "type": "False"
      },
      {
        "fromIndex": 10,
        "toIndex": 11,
        "type": "True"
      },
      {
        "fromIndex": 11,
        "toIndex": 12,
        "type": "Success"
      },
      {
        "fromIndex": 13,
        "toIndex": 12,
        "type": "Success"
      },
      {
        "fromIndex": 14,
        "toIndex": 12,
        "type": "False"
      },
      {
        "fromIndex": 14,
        "toIndex": 13,
        "type": "True"
      }
    ],
    "ruleChainConnections": null
  }
}